# GitHub 기반 코드 분석 챗봇: RAG 기반 LLM과 벡터 데이터베이스 연동 구현 코드 가이드

> 해당 문서는 개발된 소프트웨어에서 RAG와 LLM, 벡터 데이터베이스를 연동하고 있는 코드의 위치와 특징을 설명하기 위해 작성되었습니다.
# 벡터 데이터베이스 생성 및 활용 과정

## 1. 코드 분석 및 임베딩

### 1.1 GitHub 저장소 분석
- 파일: `github_analyzer.py`
- 위치: line 41-128
- 주요 기능:
  - GitHub API를 통한 저장소 접근
  - 파일 구조 분석 및 필터링
  - 코드 파일 추출 및 전처리

### 1.2 코드 청크 생성
- 파일: `github_analyzer.py`
- 위치: line 533-551
- 주요 기능:
  - 코드를 의미 있는 단위로 분할
  - 토큰 기반 청크 크기 관리
  - 중복 제거 및 청크 최적화

### 1.3 임베딩 생성
- 파일: `github_analyzer.py`
- 위치: line 1081-1106
- 주요 기능:
  - OpenAI API를 통한 임베딩 생성
  - 메타데이터 구성 및 저장
  - 벡터 데이터베이스 저장

## 2. 데이터 검색 및 활용

### 2.1 유사 코드 검색
- 파일: `chat_handler.py`
- 위치: line 305-430
- 주요 기능:
  - 사용자 질문 임베딩 생성
  - 유사도 기반 코드 청크 검색
  - 메타데이터 기반 필터링

### 2.2 대화 기록 관리
- 파일: `chat_memory.py`
- 위치: line 45-105
- 주요 기능:
  - 대화 기록 저장
  - 관련 대화 검색
  - 컨텍스트 유지

### 2.3 응답 생성
- 파일: `chat_handler.py`
- 위치: line 178-305
- 주요 기능:
  - 검색된 코드 컨텍스트 활용
  - 이전 대화 기록 참조
  - LLM을 통한 응답 생성

## 3. 주요 특징

### 3.1 코드 분석 최적화
- **토큰 기반 청크 크기 관리**: OpenAI API의 토큰 제한을 고려하여 각 청크의 크기를 최적화하고, 의미 있는 코드 단위를 유지하면서 분할합니다.
- **의미 있는 코드 단위 분할**: 함수, 클래스, 메서드 등의 논리적 단위를 기준으로 코드를 분할하여 컨텍스트의 일관성을 유지합니다.
- **메타데이터 기반 구조화**: 파일 경로, 함수명, 클래스명, 라인 번호 등 상세한 메타데이터를 추출하여 코드의 구조와 관계를 명확히 합니다.
- **파일 형식별 청킹 전략**: Python, JavaScript, Markdown 등 파일 형식에 따라 다른 청킹 전략을 적용하여 각 언어의 특성을 고려한 최적의 분할을 수행합니다.

### 3.2 검색 최적화
- **유사도 기반 검색**: 코사인 유사도를 사용하여 사용자 질문과 가장 관련성 높은 코드 청크를 검색하고, 정확도를 높입니다.
- **메타데이터 필터링**: 파일 타입, 함수명, 클래스명 등 메타데이터를 활용하여 검색 결과를 필터링하고 관련성을 높입니다.
- **컨텍스트 기반 정렬**: 검색된 청크들의 메타데이터와 유사도 점수를 종합적으로 고려하여 최적의 순서로 정렬합니다.

### 3.3 성능 최적화
- **비동기 처리**: OpenAI API 호출과 임베딩 생성을 비동기적으로 처리하여 전체 처리 시간을 단축합니다.
- **배치 처리**: 여러 코드 청크를 한 번에 처리하여 API 호출 횟수를 줄이고 효율성을 높입니다.
- **캐싱 전략**: 자주 사용되는 임베딩과 검색 결과를 캐시하여 반복적인 계산을 줄이고 응답 시간을 개선합니다.
